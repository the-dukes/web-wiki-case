import{_ as n,o as s,c as a,a as p}from"./app-bb81f29b.js";const t={},o=p(`<h1 id="_01-微信" tabindex="-1"><a class="header-anchor" href="#_01-微信" aria-hidden="true">#</a> 01-微信</h1><h2 id="app-微信公众号链接" tabindex="-1"><a class="header-anchor" href="#app-微信公众号链接" aria-hidden="true">#</a> app 微信公众号链接</h2><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">getShareLink</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">===</span> <span class="token string">&#39;cs&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      str <span class="token operator">+=</span> <span class="token string">&#39;&amp;&#39;</span> <span class="token operator">+</span> key <span class="token operator">+</span> <span class="token string">&#39;=&#39;</span> <span class="token operator">+</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>str<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> shareDomain <span class="token operator">+</span> <span class="token string">&#39;?&#39;</span> <span class="token operator">+</span> str<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> shareDomain<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">getShareLinkNew</span><span class="token punctuation">(</span><span class="token parameter">csparamval</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> shareDomain <span class="token operator">+</span> <span class="token string">&#39;?cs=&#39;</span> <span class="token operator">+</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>csparamval<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&#39;&amp;sc=SHARE_MP&#39;</span> <span class="token operator">+</span> csparamval<span class="token punctuation">[</span><span class="token string">&#39;url&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="微信分享、朋友圈分享" tabindex="-1"><a class="header-anchor" href="#微信分享、朋友圈分享" aria-hidden="true">#</a> 微信分享、朋友圈分享</h2><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// JS-SDK 必须先注入配置信息，否则将无法调用</span>
<span class="token keyword">function</span> <span class="token function">getWXjssdksign</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">commonApi</span><span class="token operator">:</span> CommonApi<span class="token punctuation">,</span> <span class="token literal-property property">jsApiList</span><span class="token operator">:</span> any<span class="token punctuation">,</span> success<span class="token operator">?</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>AppUtil<span class="token punctuation">.</span>isMicroMessager<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> url <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#39;#&#39;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> str <span class="token operator">=</span> navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> wxArr <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">MicroMessenger\\/([\\d\\.]+)</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>AppUtil<span class="token punctuation">.</span>isIOS <span class="token operator">&amp;&amp;</span> wxArr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> version <span class="token operator">=</span> wxArr<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#39;.&#39;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span>version<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      url <span class="token operator">=</span> AppUtil<span class="token punctuation">.</span>firstUrl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  jsApiList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>AppUtil<span class="token punctuation">.</span>jsApiList<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      AppUtil<span class="token punctuation">.</span>jsApiList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  commonApi<span class="token punctuation">.</span><span class="token function">WXJSSdkSignature</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token literal-property property">url</span><span class="token operator">:</span> url<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>data <span class="token operator">&amp;&amp;</span> result<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      wx<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">debug</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 开启调试模式,</span>
        <span class="token literal-property property">appId</span><span class="token operator">:</span> result<span class="token punctuation">.</span>data<span class="token punctuation">.</span>appid<span class="token punctuation">,</span> <span class="token comment">// 必填，公众号的唯一标识</span>
        <span class="token literal-property property">timestamp</span><span class="token operator">:</span> result<span class="token punctuation">.</span>data<span class="token punctuation">.</span>timestamp<span class="token punctuation">,</span> <span class="token comment">// 必填，生成签名的时间戳</span>
        <span class="token literal-property property">nonceStr</span><span class="token operator">:</span> result<span class="token punctuation">.</span>data<span class="token punctuation">.</span>nonceStr<span class="token punctuation">,</span> <span class="token comment">// 必填，生成签名的随机串</span>
        <span class="token literal-property property">signature</span><span class="token operator">:</span> result<span class="token punctuation">.</span>data<span class="token punctuation">.</span>signature<span class="token punctuation">,</span> <span class="token comment">// 必填，签名，见附录1</span>
        <span class="token literal-property property">jsApiList</span><span class="token operator">:</span> AppUtil<span class="token punctuation">.</span>jsApiList <span class="token comment">// 必填，需要使用的JS接口列表，所有JS接口列表见附录2</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        success <span class="token operator">&amp;&amp;</span> <span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//微信公众号分享朋友及朋友圈Menu设置</span>
<span class="token keyword">function</span> <span class="token function">setWeixinShareMenu</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">commonApi</span><span class="token operator">:</span> CommonApi<span class="token punctuation">,</span> <span class="token literal-property property">data</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>AppUtil<span class="token punctuation">.</span>isMicroMessager<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&#39;onMenuShareTimeline&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;onMenuShareAppMessage&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getWXjssdksign</span><span class="token punctuation">(</span>commonApi<span class="token punctuation">,</span> arr<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    wx<span class="token punctuation">.</span><span class="token function">onMenuShareTimeline</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    wx<span class="token punctuation">.</span><span class="token function">onMenuShareAppMessage</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//微信公众号分享朋友及朋友圈Menu设置</span>
<span class="token keyword">function</span> <span class="token function">setDfWeixinShareMenu</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">commonApi</span><span class="token operator">:</span> CommonApi</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> mpdata <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">title</span><span class="token operator">:</span> AppLang<span class="token punctuation">.</span>common<span class="token punctuation">[</span><span class="token string">&#39;apptitle&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">desc</span><span class="token operator">:</span> AppLang<span class="token punctuation">.</span>common<span class="token punctuation">[</span><span class="token string">&#39;defaultsharingdescription&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">link</span><span class="token operator">:</span> ApiConfig<span class="token punctuation">.</span><span class="token function">getShareUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&#39;?sc=SHARE_MP&amp;rd=&#39;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>AppMember<span class="token punctuation">.</span><span class="token function">GetInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>id <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getTwoRandom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">imgUrl</span><span class="token operator">:</span> AppUtil<span class="token punctuation">.</span><span class="token function">formatLocalImgPath</span><span class="token punctuation">(</span><span class="token string">&#39;assets/img/app_logo_square.png&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setWeixinShareMenu</span><span class="token punctuation">(</span>commonApi<span class="token punctuation">,</span> mpdata<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用</span>

<span class="token keyword">function</span> <span class="token function">setWeixinShareMenuForMP</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> _self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> csparamval <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">isshare</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token literal-property property">p</span><span class="token operator">:</span> <span class="token string">&#39;LM&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>course_id
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> turl <span class="token operator">=</span>
    ApiConfig<span class="token punctuation">.</span><span class="token function">getServerDomain</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span>
    <span class="token string">&#39;/mpwx/main.html?cs=&#39;</span> <span class="token operator">+</span>
    <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>AppUtil<span class="token punctuation">.</span><span class="token function">ToBase64</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>csparamval<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span>
    <span class="token string">&#39;&amp;rd=&#39;</span> <span class="token operator">+</span>
    <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>member<span class="token punctuation">.</span>id <span class="token operator">+</span> AppUtil<span class="token punctuation">.</span><span class="token function">getTwoRandom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span>
    <span class="token string">&#39;&amp;sc=SHARE_MP&#39;</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>turl<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> mpdata <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">title</span><span class="token operator">:</span> AppLang<span class="token punctuation">.</span>game<span class="token punctuation">[</span><span class="token string">&#39;shareTitle&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 分享标题</span>
    <span class="token literal-property property">desc</span><span class="token operator">:</span> AppLang<span class="token punctuation">.</span>game<span class="token punctuation">[</span><span class="token string">&#39;shareGameDesc&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 分享描述</span>
    <span class="token literal-property property">link</span><span class="token operator">:</span> turl<span class="token punctuation">,</span>
    <span class="token literal-property property">imgUrl</span><span class="token operator">:</span> AppUtil<span class="token punctuation">.</span><span class="token function">formatLocalImgPath</span><span class="token punctuation">(</span><span class="token string">&#39;assets/img/clean-finance/share_img.png&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//this.courseData.course_share, // 分享图标</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;link&#39;</span><span class="token punctuation">,</span> <span class="token comment">// 分享类型,music、video或link，不填默认为link</span>
    <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      _self<span class="token punctuation">.</span><span class="token function">shareSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  AppUtil<span class="token punctuation">.</span><span class="token function">setWeixinShareMenu</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>commonApi<span class="token punctuation">,</span> mpdata<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,5),e=[o];function c(l,i){return s(),a("div",null,e)}const k=n(t,[["render",c],["__file","01-weixin.html.vue"]]);export{k as default};
